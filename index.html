<!DOCTYPE html>
<html>
	<head>
		<title>Lyrictionary</title>
		<link rel="stylesheet" type="text/css" href="bootstrap/bootstrap.min.css" />
		<link rel="stylesheet" type="text/css" href="liri.css" />
		<script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
		<script src="contentflow/contentflow.js"></script>
		<script src="jwplayer/jwplayer.js"></script>
		<link href='http://fonts.googleapis.com/css?family=Signika+Negative:300,700' rel='stylesheet' type='text/css'>
	</head>
	<body>
	    <div id="liri">
    	    <div id="text-input">
    	        <input type="text" speech x-webkit-speech />
    	    </div>
    		<div id="coverflow">
    		    <div id="ContentFlow" class="ContentFlow">
        		    <div class="loadIndicator"><div class="indicator"></div></div>
        		    <div class="flow"></div>
        		    <div class="globalCaption"></div>
        		</div>
        		<div id="itemcontainer" style="visibility:hidden;"></div>
        	</div>
        	<!--<div id="video">
        	    <p id="videocontainer">The player will be placed here</p>
        	</div>-->
        </div>
    	<script type="text/javascript">
		    var ContentFlow = new ContentFlow('ContentFlow');
			if(navigator.onLine) {
				var musixmatchURL = 'http://api.musixmatch.com/ws/1.1/track.search?f_has_subtitle=1&apikey=72972dafed8a3b90df4e80d022e47642';
				var input = document.querySelector('[x-webkit-speech]');
				//input.addEventListener('change', inputChange, false);
				input.addEventListener('webkitspeechchange', function (e) {
					if(e.results && e.type === 'webkitspeechchange') {
						var searchTerm = encodeURI(e.results[0].utterance);
						if(searchTerm.length > 0) {
						    $.getJSON(musixmatchURL + '&q_lyrics=' + searchTerm + '&format=JSONP&callback=?', function(data) {
						        console.log(data);
						        if(data.message.header.status_code == "200") {
						            if(data.message.body.track_list) {
						                makeCoverflow(data.message.body.track_list);
						            }
						        }
						    });
							//getMusixLyrics(searchTerm);
						}
					}
				}, false);
				
				function getMusixLyrics(searchTerm) {
				    $.getJSON(musixmatchURL + '&q_lyrics=' + searchTerm + '&format=JSONP&callback=?', function(data) {
				        if(data.message.header.status_code == "200") {
				            if(data.message.body.track_list) {
				                makeCoverflow(data.message.body.track_list);
				            }
				        }
				    });
				}
				
				function makeCoverflow(data) {
				    if(ContentFlow.getNumberOfItems() > 0) {
				        $.each($('.flow .item'), function(i, el) {
    				        ContentFlow.rmItem(el);
    				    });
				    }
				    for(var i = 0, c = data.length; i < c; i++) {
				        $('#itemcontainer').append('<img class="item" src="'+data[i].track.album_coverart_100x100+'" title="'+data[i].track.artist_name+' by '+data[i].track.track_name+'" href="#" onclick="getYoutubeVideo('+data[i].track.track_id+',\''+data[i].track.artist_name+' '+data[i].track.track_name+'\'); return false;" />');
				    }
				    $.each($('#itemcontainer img'), function(i, el) {
				        ContentFlow.addItem(el, 'last');
				    });
				}
				
				function getYoutubeVideo(lyricid, searchq) {
				    $.getJSON('http://gdata.youtube.com/feeds/api/videos?orderby=relevance&max-results=10&v=2&category=Music&format=5&client=playlistify&q=' + searchq + '&alt=json-in-script&callback=?', function(data) {
				        console.log(data);
				        if(!data) {
				            alert('no data from youtube');
				        } else {
				            var urlembed = data.feed.entry[0].content.src;
				        }
				        jwplayer('videocontainer').setup({
				            'flashplayer': 'jwplayer/player.swf',
				            'autostart': true,
				            'id': 'videocontainer',
				            'width': '480',
				            'height': '270',
				            'file': urlembed,
				            'plugins': {
				                'captions-2': {
				                    'file': 'http://roelandp.nl/devdev/musichackday/getdfxp.php?trackid=' + lyricid
				                }
				            }
				        });
				        console.log(urlembed);
				    });
				}
			}
		</script>
	</body>
</html>